/****** Object:  Procedure [BT].[spPouplateImages]    Committed by VersionSQL https://www.versionsql.com ******/

CREATE PROCEDURE  [BT].[spPouplateImages](@PROJECTID INT) 
AS
CREATE TABLE #TEMP0(Id int,Name VARCHAR(100), ParentId int)

INSERT INTO #TEMP0(ID,NAME,PARENTID)
SELECT DISTINCT YEAR(DPRDATE) ID, YEAR(DPRDATE) NAME, NULL PARENTID  FROM BT.DPRIMAGE WHERE PROJECTID = @PROJECTID ORDER BY YEAR(DPRDATE)  


SELECT DISTINCT STR(YEAR(DPRDATE),4)+LTRIM(STR(MONTH(DPRDATE),2)) ID,
       DATENAME(MONTH,DPRDATE) NAME, 
	   YEAR(DPRDATE) PARENTID,YEAR(DPRDATE) YR,MONTH(DPRDATE) MN 
INTO #TEMP1
FROM BT.DPRIMAGE  
WHERE PROJECTID=@PROJECTID 
 

INSERT INTO #TEMP0(ID,NAME,PARENTID)
SELECT ID,NAME,PARENTID FROM #TEMP1 
ORDER BY YR,MN



INSERT INTO #TEMP0(ID,NAME,PARENTID)
SELECT DISTINCT STR(YEAR(DPRDATE),4)+LTRIM(STR(MONTH(DPRDATE),2))+LTRIM(LEFT(CONVERT(VARCHAR(10),DPRDATE,103),2)) ID ,
       CONVERT(VARCHAR,DPRDATE,103) NAME,
	   STR(YEAR(DPRDATE),4)+LTRIM(STR(MONTH(DPRDATE),2)) PARENTID 
FROM 
       BT.DPRIMAGE 
WHERE  PROJECTID=@PROJECTID    


INSERT INTO #TEMP0(ID,NAME,PARENTID)
SELECT DPRID,
       NARRATION NAME,
	   STR(YEAR(DPRDATE),4)+LTRIM(STR(MONTH(DPRDATE),2))+LTRIM(LEFT(CONVERT(VARCHAR(10),DPRDATE,103),2)) PADPRENTID 
FROM 
       BT.DPRIMAGE 
WHERE 
       PROJECTID=@PROJECTID 
ORDER BY DPRDATE 

 

SELECT * FROM #TEMP0 ORDER BY ID 