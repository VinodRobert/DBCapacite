/****** Object:  Procedure [PB].[spGetPaymentBanks]    Committed by VersionSQL https://www.versionsql.com ******/

CREATE PROCEDURE [PB].[spGetPaymentBanks](@BORGID INT)
AS
 
 INSERT INTO PB.PAYMENTBANKS(BANKID,BORGID,    BANKNAME,BANKACCOUNT,ADDRESS1,    ADDRESS2,    ADDRESS3,    PIN,      LEDGERCODE,LETTERHEADID)
 SELECT                      BANKID,BANKBORGID,BANKNAME,BANKACCOUNT,BANKADDRESS1,BANKADDRESS2,BANKADDRESS3,BANKPCODE,BANKLEDGER,0
 FROM BANKS WHERE 
 BANKBORGID = @BORGID AND BANKID NOT IN (SELECT BANKID FROM PB.PAYMENTBANKS) AND LEFT(BANKACCOUNT,3)<>'WHT' 
 
 UPDATE PB.PAYMENTBANKS SET BANKNAME=UPPER(BANKNAME) 
 DELETE FROM PB.PAYMENTBANKS WHERE BANKNAME='-'
 UPDATE PB.PAYMENTBANKS SET SERIALNUMBER=0 WHERE SERIALNUMBER IS NULL
 UPDATE PB.PAYMENTBANKS SET CHEQUE = 0 WHERE CHEQUE IS NULL
 UPDATE PB.PAYMENTBANKS SET RTGS = 0 WHERE RTGS IS NULL
 UPDATE PB.PAYMENTBANKS SET API = 0 WHERE API IS NULL

 SELECT PB.BANKID,B.BORGNAME,PB.BORGID,PB.BANKNAME,PB.BANKACCOUNT,PB.ADDRESS1,PB.ADDRESS2,PB.ADDRESS3,PB.STATE,PB.PIN,PB.LEDGERCODE,
 L.LEDGERNAME,PB.REFERENCE,PB.YEARREFERENCE,PB.SERIALNUMBER,PB.CHEQUE,PB.RTGS,PB.API ,PB.SALUTATION ,PB.LETTERHEADID,PB.ACCOUNTTYPE,PB.BANKBRANCH
 FROM PB.PAYMENTBANKS PB INNER JOIN BORGS B ON PB.BORGID=B.BORGID INNER JOIN LEDGERCODES L ON PB.LEDGERCODE=L.LEDGERCODE 
 WHERE PB.BORGID = @BORGID 
 ORDER BY BORGID 

 SELECT BANKID,(LTRIM(RTRIM(BANKNAME))+' A/c No '+LTRIM(RTRIM(BANKACCOUNT))) BANKNAME 
  FROM PB.PAYMENTBANKS WHERE BORGID=@BORGID ORDER BY BANKNAME 
 