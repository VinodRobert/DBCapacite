/****** Object:  View [dbo].[ACTIVITIESINGROUP]    Committed by VersionSQL https://www.versionsql.com ******/

  CREATE VIEW ACTIVITIESINGROUP  AS /*Lists per user all activities in include selection and not in exclude selection*/ SELECT DISTINCT TABLEINCLUDE.ACTID, TABLEINCLUDE.CONTRID, TABLEINCLUDE.SYS, TABLEINCLUDE.BORGID FROM ( 	/*Select All activities included or not set up*/ 	select CONTRACTS.CONTRID, ACTIVITIES.ActID, S.SYS, BORGS.BORGID 	from BORGS 	inner join PROJECTS on PROJECTS.BORGID = BORGS.BORGID 	inner join CONTRACTS on CONTRACTS.PROJID = PROJECTS.PROJID 	CROSS JOIN 	ACTIVITIES 	CROSS JOIN 	( 	select 'ACC' SYS union all 	select 'POS' SYS union all 	select 'WGS' SYS 	) S 	left outer join LEDGERCODEGROUPLINK LCGL on LCGL.HID = -1 and LCGL.LEV = 0 	WHERE CONTRACTS.CONSTATUS <> 2 	AND ((LCGL.LEV = 0 and LCGL.INC = 1) OR (LCGL.HID is null)) 	/*union with all activities turned on at group level*/ 	UNION ALL 	select CONTRACTS.CONTRID, ACTIVITIES.ACTID, LCGH.SYS, BORGS.BORGID 	from BORGS 	inner join PROJECTS on PROJECTS.BORGID = BORGS.BORGID 	inner join CONTRACTS on CONTRACTS.PROJID = PROJECTS.PROJID 	inner join LEDGERCODEGROUPLINK LCGL on LCGL.THEID = -1 and LCGL.LEV = 0 	inner join LEDGERCODEGROUPDETAIL LCGD on LCGL.HID = LCGD.HID and LCGD.TYPE = 'ACT' 	inner join LEDGERCODEGROUPHEADER LCGH on LCGL.HID = LCGH.ID 	inner join ACTIVITIES on LCGD.TID = ACTIVITIES.ActID 	WHERE LCGL.INC = 1 	AND LCGH.ALLOC = 'Contracts' 	AND CONTRACTS.CONSTATUS <> 2 	/*union with all activities turned on at borg level*/ 	UNION ALL 	select CONTRACTS.CONTRID, ACTIVITIES.ACTID, LCGH.SYS, BORGS.BORGID 	from BORGS 	inner join PROJECTS on PROJECTS.BORGID = BORGS.BORGID 	inner join CONTRACTS on CONTRACTS.PROJID = PROJECTS.PROJID 	inner join LEDGERCODEGROUPLINK LCGL on LCGL.THEID = BORGS.BORGID and LCGL.LEV = 1 	inner join LEDGERCODEGROUPDETAIL LCGD on LCGL.HID = LCGD.HID and LCGD.TYPE = 'ACT' 	inner join LEDGERCODEGROUPHEADER LCGH on LCGL.HID = LCGH.ID 	inner join ACTIVITIES on LCGD.TID = ACTIVITIES.ActID 	WHERE LCGL.INC = 1 	AND LCGH.ALLOC = 'Contracts' 	AND CONTRACTS.CONSTATUS <> 2 	/*union with all activities turned on at project level*/ 	UNION ALL 	select CONTRACTS.CONTRID, ACTIVITIES.ACTID, LCGH.SYS, BORGS.BORGID 	from BORGS 	inner join PROJECTS on PROJECTS.BORGID = BORGS.BORGID 	inner join CONTRACTS on CONTRACTS.PROJID = PROJECTS.PROJID 	inner join LEDGERCODEGROUPLINK LCGL on LCGL.THEID = PROJECTS.PROJID and LCGL.LEV = 2 	inner join LEDGERCODEGROUPDETAIL LCGD on LCGL.HID = LCGD.HID and LCGD.TYPE = 'ACT' 	inner join LEDGERCODEGROUPHEADER LCGH on LCGL.HID = LCGH.ID 	inner join ACTIVITIES on LCGD.TID = ACTIVITIES.ActID 	WHERE LCGL.INC = 1 	AND LCGH.ALLOC = 'Contracts' 	AND CONTRACTS.CONSTATUS <> 2 	 /*union with all activities turned on at contract level*/ 	UNION ALL 	select CONTRACTS.CONTRID, ACTIVITIES.ACTID, LCGH.SYS, BORGS.BORGID 	from BORGS 	inner join PROJECTS on PROJECTS.BORGID = BORGS.BORGID 	inner join CONTRACTS on CONTRACTS.PROJID = PROJECTS.PROJID 	inner join LEDGERCODEGROUPLINK LCGL on LCGL.THEID = CONTRACTS.CONTRID and LCGL.LEV = 3 	inner join LEDGERCODEGROUPDETAIL LCGD on LCGL.HID = LCGD.HID and LCGD.TYPE = 'ACT' 	inner join LEDGERCODEGROUPHEADER LCGH on LCGL.HID = LCGH.ID 	inner join ACTIVITIES on LCGD.TID = ACTIVITIES.ActID 	WHERE LCGL.INC = 1 	AND LCGH.ALLOC = 'Contracts' 	AND CONTRACTS.CONSTATUS <> 2 ) as TABLEINCLUDE left outer join ( 	/*select all activities excluded at borg level, not included at project or contract level*/ 	select CONTRACTS.CONTRID, ACTIVITIES.ACTID, LCGH.SYS, BORGS.BORGID 	from BORGS 	inner join PROJECTS on PROJECTS.BORGID = BORGS.BORGID 	inner join CONTRACTS on CONTRACTS.PROJID = PROJECTS.PROJID 	inner join LEDGERCODEGROUPLINK LCGL on LCGL.THEID = BORGS.BORGID and LCGL.LEV = 1 	inner join LEDGERCODEGROUPDETAIL LCGD on LCGL.HID = LCGD.HID and LCGD.TYPE = 'ACT' 	inner join LEDGERCODEGROUPHEADER LCGH on LCGL.HID = LCGH.ID 	inner join ACTIVITIES on LCGD.TID = ACTIVITIES.ActID 	left outer join ( 		select CONTRACTS.CONTRID, ACTIVITIES.ACTID, LCGH.SYS, BORGS.BORGID 		from BORGS 		inner join PROJECTS on PROJECTS.BORGID = BORGS.BORGID 		inner join CONTRACTS on CONTRACTS.PROJID = PROJECTS.PROJID 		inner join LEDGERCODEGROUPLINK LCGL on LCGL.THEID = CONTRACTS.CONTRID and LCGL.LEV = 3 		inner join LEDGERCODEGROUPDETAIL LCGD on LCGL.HID = LCGD.HID and LCGD.TYPE = 'ACT' 		inner join LEDGERCODEGROUPHEADER LCGH on LCGL.HID = LCGH.ID 		inner join ACTIVITIES on LCGD.TID = ACTIVITIES.ActID 		WHERE LCGL.INC = 1 	    AND LCGH.ALLOC = 'Contracts' 		AND CONTRACTS.CONSTATUS <> 2 	) IC 	on IC.CONTRID = CONTRACTS.CONTRID 	and IC.ActID = ACTIVITIES.ActID 	and IC.SYS = LCGH.SYS 	left outer join ( 		select CONTRACTS.CONTRID, ACTIVITIES.ACTID, LCGH.SYS, BORGS.BORGID 		from BORGS 		inner join PROJECTS on PROJECTS.BORGID = BORGS.BORGID 		inner join CONTRACTS on CONTRACTS.PROJID = PROJECTS.PROJID 		inner join LEDGERCODEGROUPLINK LCGL on LCGL.THEID = PROJECTS.PROJID and LCGL.LEV = 2 		inner join LEDGERCODEGROUPDETAIL LCGD on LCGL.HID = LCGD.HID and LCGD.TYPE = 'ACT' 		inner join LEDGERCODEGROUPHEADER LCGH on LCGL.HID = LCGH.ID 		inner join ACTIVITIES on LCGD.TID = ACTIVITIES.ActID 		WHERE LCGL.INC = 1 	    AND LCGH.ALLOC = 'Contracts' 		AND CONTRACTS.CONSTATUS <> 2 	) IP 	on IP.CONTRID = CONTRACTS.CONTRID 	and IP.ActID = ACTIVITIES.ActID 	and IP.SYS = LCGH.SYS 	WHERE LCGL.INC = 0 	and IC.ActID is null 	and IP.ActID is null 	AND LCGH.ALLOC = 'Contracts' 	/*select all activities excluded at project level, not included at contract level*/ 	UNION ALL 	select CONTRACTS.CONTRID, ACTIVITIES.ACTID, LCGH.SYS, BORGS.BORGID 	from BORGS 	inner join PROJECTS on PROJECTS.BORGID = BORGS.BORGID 	inner join CONTRACTS on CONTRACTS.PROJID = PROJECTS.PROJID 	inner join LEDGERCODEGROUPLINK LCGL on LCGL.THEID = PROJECTS.PROJID and LCGL.LEV = 2 	inner join LEDGERCODEGROUPDETAIL LCGD on LCGL.HID = LCGD.HID and LCGD.TYPE = 'ACT' 	inner join LEDGERCODEGROUPHEADER LCGH on LCGL.HID = LCGH.ID 	inner join ACTIVITIES on LCGD.TID = ACTIVITIES.ActID 	left outer join ( 		select CONTRACTS.CONTRID, ACTIVITIES.ACTID, LCGH.SYS, BORGS.BORGID 		from BORGS 		inner join PROJECTS on PROJECTS.BORGID = BORGS.BORGID 		inner join CONTRACTS on CONTRACTS.PROJID = PROJECTS.PROJID 		inner join LEDGERCODEGROUPLINK LCGL on LCGL.THEID = CONTRACTS.CONTRID and LCGL.LEV = 3 		inner join LEDGERCODEGROUPDETAIL LCGD on LCGL.HID = LCGD.HID and LCGD.TYPE = 'ACT' 		inner join LEDGERCODEGROUPHEADER LCGH on LCGL.HID = LCGH.ID 		inner join ACTIVITIES on LCGD.TID = ACTIVITIES.ActID 		WHERE LCGL.INC = 1 		AND CONTRACTS.CONSTATUS <> 2 	    AND LCGH.ALLOC = 'Contracts' 	) IA 	on IA.CONTRID = CONTRACTS.CONTRID 	and IA.ActID = ACTIVITIES.ActID 	and IA.SYS = LCGH.SYS 	WHERE LCGL.INC = 0 	and IA.ActID is null 	AND LCGH.ALLOC = 'Contracts' 	/*select all activities excluded at contract level*/ 	UNION ALL 	select CONTRACTS.CONTRID, ACTIVITIES.ACTID, LCGH.SYS, BORGS.BORGID 	from BORGS 	inner join PROJECTS on PROJECTS.BORGID = BORGS.BORGID 	inner join CONTRACTS on CONTRACTS.PROJID = PROJECTS.PROJID 	inner join LEDGERCODEGROUPLINK LCGL on LCGL.THEID = CONTRACTS.CONTRID and LCGL.LEV = 3 	inner join LEDGERCODEGROUPDETAIL LCGD on LCGL.HID = LCGD.HID and LCGD.TYPE = 'ACT' 	inner join LEDGERCODEGROUPHEADER LCGH on LCGL.HID = LCGH.ID 	inner join ACTIVITIES on LCGD.TID = ACTIVITIES.ActID 	WHERE LCGL.INC = 0 	AND LCGH.ALLOC = 'Contracts' ) as TABLEEXCLUDE on TABLEINCLUDE.CONTRID = TABLEEXCLUDE.CONTRID AND TABLEINCLUDE.ACTID = TABLEEXCLUDE.ACTID AND TABLEINCLUDE.SYS = TABLEEXCLUDE.SYS WHERE TABLEEXCLUDE.CONTRID IS NULL AND TABLEEXCLUDE.ACTID IS NULL AND TABLEEXCLUDE.SYS IS NULL 