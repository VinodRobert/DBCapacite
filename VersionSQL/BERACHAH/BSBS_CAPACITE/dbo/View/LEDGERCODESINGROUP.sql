/****** Object:  View [dbo].[LEDGERCODESINGROUP]    Committed by VersionSQL https://www.versionsql.com ******/

  CREATE VIEW LEDGERCODESINGROUP  AS /*Lists per user all cost codes in include selection and not in exclude selection*/ SELECT DISTINCT TABLEINCLUDE.LEDGERID, TABLEINCLUDE.CONTRID, TABLEINCLUDE.DIVID, TABLEINCLUDE.PEID, TABLEINCLUDE.SYS, TABLEINCLUDE.BORGID FROM ( 	/*------------------------Include at level 0 - default------------------------*/ 	/*Select All Balance Sheet LEDGERCODES included at default level*/ 	select null CONTRID, null DIVID, null PEID, LEDGERCODES.LEDGERID, LEDGERCODES.LEDGERALLOC ALLOC, S.SYS, NULL BORGID 	from LEDGERCODES 	CROSS JOIN 	( 	select 'ACC' SYS union all 	select 'POS' SYS union all 	select 'WGS' SYS 	) S 	left outer join LEDGERCODEGROUPLINK LCGL on LCGL.HID = -1 and LCGL.LEV = 0 	WHERE  LEDGERCODES.LEDGERALLOC = 'Balance Sheet' 	AND ((LCGL.LEV = 0 and LCGL.INC = 1) OR (LCGL.HID is null)) 	/*Select All Contract LEDGERCODES included at default level*/ 	union ALL 	select CONTRACTS.CONTRID CONTRID, null DIVID, null PEID, LEDGERCODES.LEDGERID, LEDGERCODES.LEDGERALLOC ALLOC, S.SYS, BORGS.BORGID 	from BORGS 	inner join PROJECTS on PROJECTS.BORGID = BORGS.BORGID 	inner join CONTRACTS on CONTRACTS.PROJID = PROJECTS.PROJID 	CROSS JOIN 	LEDGERCODES 	CROSS JOIN 	( 	select 'ACC' SYS union all 	select 'POS' SYS union all 	select 'WGS' SYS 	) S 	left outer join LEDGERCODEGROUPLINK LCGL on LCGL.HID = -1 and LCGL.LEV = 0 	WHERE CONTRACTS.CONSTATUS <> 2 	AND LEDGERCODES.LEDGERALLOC = 'Contracts' 	AND ((LCGL.LEV = 0 and LCGL.INC = 1) OR (LCGL.HID is null)) 	/*Select All Overheads LEDGERCODES included at default level*/ 	union ALL 	select null CONTRID, DIVISIONS.DIVID DIVID, null PEID, LEDGERCODES.LEDGERID, LEDGERCODES.LEDGERALLOC ALLOC, S.SYS, BORGS.BORGID 	from BORGS 	inner join DIVISIONS on DIVISIONS.BORGID = BORGS.BORGID 	CROSS JOIN 	LEDGERCODES 	CROSS JOIN 	( 	select 'ACC' SYS union all 	select 'POS' SYS union all 	select 'WGS' SYS 	) S 	left outer join LEDGERCODEGROUPLINK LCGL on LCGL.HID = -1 and LCGL.LEV = 0 	WHERE DIVISIONS.DIVSTATUS <> 2 	AND LEDGERCODES.LEDGERALLOC = 'Overheads' 	AND ((LCGL.LEV = 0 and LCGL.INC = 1) OR (LCGL.HID is null)) 	/*Select All Plant LEDGERCODES included at default level*/ 	union ALL 	select null CONTRID, null DIVID, PLANTANDEQ.PEID PEID, LEDGERCODES.LEDGERID, LEDGERCODES.LEDGERALLOC ALLOC, S.SYS, BORGS.BORGID 	from BORGS 	inner join PLANTANDEQ on PLANTANDEQ.BORGID = BORGS.BORGID 	CROSS JOIN 	LEDGERCODES 	CROSS JOIN 	( 	select 'ACC' SYS union all 	select 'POS' SYS union all 	select 'WGS' SYS 	) S 	left outer join LEDGERCODEGROUPLINK LCGL on LCGL.HID = -1 and LCGL.LEV = 0 	WHERE PLANTANDEQ.PESTATUS <> 2 	AND LEDGERCODES.LEDGERALLOC = 'Plant' 	AND ((LCGL.LEV = 0 and LCGL.INC = 1) OR (LCGL.HID is null)) 	/*------------------------Include at level 0------------------------*/ 	/*union with all Balance Sheet LEDGERCODES turned on at group level*/ 	UNION ALL 	select null CONTRID, null DIVID, null PEID, LEDGERCODES.LEDGERID, LEDGERCODES.LEDGERALLOC ALLOC, LCGH.SYS, NULL BORGID 	from LEDGERCODEGROUPLINK LCGL 	inner join LEDGERCODEGROUPDETAIL LCGD on LCGL.HID = LCGD.HID and LCGD.TYPE = 'LED' 	inner join LEDGERCODEGROUPHEADER LCGH on LCGL.HID = LCGH.ID 	inner join LEDGERCODES on LCGD.TID = LEDGERCODES.LEDGERID 	WHERE LCGL.THEID = -1 	and LCGL.LEV = 0 	AND LCGL.INC = 1 	AND LCGH.ALLOC = 'Balance Sheet' 	AND LEDGERCODES.LEDGERALLOC = 'Balance Sheet' 	/*union with all Contract LEDGERCODES turned on at group level*/ 	UNION ALL 	select CONTRACTS.CONTRID CONTRID, null DIVID, null PEID, LEDGERCODES.LEDGERID, LEDGERCODES.LEDGERALLOC ALLOC, LCGH.SYS, BORGS.BORGID 	from BORGS 	inner join PROJECTS on PROJECTS.BORGID = BORGS.BORGID 	inner join CONTRACTS on CONTRACTS.PROJID = PROJECTS.PROJID 	inner join LEDGERCODEGROUPLINK LCGL on LCGL.THEID = -1 and LCGL.LEV = 0 	inner join LEDGERCODEGROUPDETAIL LCGD on LCGL.HID = LCGD.HID and LCGD.TYPE = 'LED' 	inner join LEDGERCODEGROUPHEADER LCGH on LCGL.HID = LCGH.ID 	inner join LEDGERCODES on LCGD.TID = LEDGERCODES.LEDGERID 	WHERE LCGL.INC = 1 	AND LCGH.ALLOC = 'Contracts' 	AND LEDGERCODES.LEDGERALLOC = 'Contracts' 	AND CONTRACTS.CONSTATUS <> 2 	/*union with all Overheads LEDGERCODES turned on at group level*/ 	UNION ALL 	select null CONTRID, DIVISIONS.DIVID DIVID, null PEID, LEDGERCODES.LEDGERID, LEDGERCODES.LEDGERALLOC ALLOC, LCGH.SYS, BORGS.BORGID 	from BORGS 	inner join DIVISIONS on DIVISIONS.BORGID = BORGS.BORGID 	inner join LEDGERCODEGROUPLINK LCGL on LCGL.THEID = -1 and LCGL.LEV = 0 	inner join LEDGERCODEGROUPDETAIL LCGD on LCGL.HID = LCGD.HID and LCGD.TYPE = 'LED' 	inner join LEDGERCODEGROUPHEADER LCGH on LCGL.HID = LCGH.ID 	inner join LEDGERCODES on LCGD.TID = LEDGERCODES.LEDGERID 	WHERE LCGL.INC = 1 	AND LCGH.ALLOC = 'Overheads' 	AND LEDGERCODES.LEDGERALLOC = 'Overheads' 	AND DIVISIONS.DIVSTATUS <> 2 	/*union with all Plant LEDGERCODES turned on at group level*/ 	UNION ALL 	select null CONTRID, null DIVID, PLANTANDEQ.PEID PEID, LEDGERCODES.LEDGERID, LEDGERCODES.LEDGERALLOC ALLOC, LCGH.SYS, BORGS.BORGID 	from BORGS 	inner join PLANTANDEQ on PLANTANDEQ.BORGID = BORGS.BORGID 	inner join LEDGERCODEGROUPLINK LCGL on LCGL.THEID = -1 and LCGL.LEV = 0 	inner join LEDGERCODEGROUPDETAIL LCGD on LCGL.HID = LCGD.HID and LCGD.TYPE = 'LED' 	inner join LEDGERCODEGROUPHEADER LCGH on LCGL.HID = LCGH.ID 	inner join LEDGERCODES on LCGD.TID = LEDGERCODES.LEDGERID 	WHERE LCGL.INC = 1 	AND LCGH.ALLOC = 'Plant' 	AND LEDGERCODES.LEDGERALLOC = 'Plant' 	AND PLANTANDEQ.PESTATUS <> 2 	/*------------------------Include at level 1------------------------*/ 	/*union with all Balance Sheet LEDGERCODES turned on at borg level*/ 	UNION ALL 	select null CONTRID, null DIVID, null PEID, LEDGERCODES.LEDGERID, LEDGERCODES.LEDGERALLOC ALLOC, LCGH.SYS, BORGS.BORGID 	from BORGS 	inner join LEDGERCODEGROUPLINK LCGL on LCGL.THEID = BORGS.BORGID and LCGL.LEV = 1 	inner join LEDGERCODEGROUPDETAIL LCGD on LCGL.HID = LCGD.HID and LCGD.TYPE = 'LED' 	inner join LEDGERCODEGROUPHEADER LCGH on LCGL.HID = LCGH.ID 	inner join LEDGERCODES on LCGD.TID = LEDGERCODES.LEDGERID 	WHERE LCGL.INC = 1 	AND LCGH.ALLOC = 'Balance Sheet' 	AND LEDGERCODES.LEDGERALLOC = 'Balance Sheet' 	/*union with all Contract LEDGERCODES turned on at borg level*/ 	UNION ALL 	select CONTRACTS.CONTRID CONTRID, null DIVID, null PEID, LEDGERCODES.LEDGERID, LEDGERCODES.LEDGERALLOC ALLOC, LCGH.SYS, BORGS.BORGID 	from BORGS 	inner join PROJECTS on PROJECTS.BORGID = BORGS.BORGID 	inner join CONTRACTS on CONTRACTS.PROJID = PROJECTS.PROJID 	inner join LEDGERCODEGROUPLINK LCGL on LCGL.THEID = BORGS.BORGID and LCGL.LEV = 1 	inner join LEDGERCODEGROUPDETAIL LCGD on LCGL.HID = LCGD.HID and LCGD.TYPE = 'LED' 	inner join LEDGERCODEGROUPHEADER LCGH on LCGL.HID = LCGH.ID 	inner join LEDGERCODES on LCGD.TID = LEDGERCODES.LEDGERID 	WHERE LCGL.INC = 1 	AND LCGH.ALLOC = 'Contracts' 	AND LEDGERCODES.LEDGERALLOC = 'Contracts' 	AND CONTRACTS.CONSTATUS <> 2 	/*union with all Overheads LEDGERCODES turned on at borg level*/ 	UNION ALL 	select null CONTRID, DIVISIONS.DIVID DIVID, null PEID, LEDGERCODES.LEDGERID, LEDGERCODES.LEDGERALLOC ALLOC, LCGH.SYS, BORGS.BORGID 	from BORGS 	inner join DIVISIONS on DIVISIONS.BORGID = BORGS.BORGID 	inner join LEDGERCODEGROUPLINK LCGL on LCGL.THEID = BORGS.BORGID and LCGL.LEV = 1 	inner join LEDGERCODEGROUPDETAIL LCGD on LCGL.HID = LCGD.HID and LCGD.TYPE = 'LED' 	inner join LEDGERCODEGROUPHEADER LCGH on LCGL.HID = LCGH.ID 	inner join LEDGERCODES on LCGD.TID = LEDGERCODES.LEDGERID 	WHERE LCGL.INC = 1 	AND LCGH.ALLOC = 'Overheads' 	AND LEDGERCODES.LEDGERALLOC = 'Overheads' 	AND DIVISIONS.DIVSTATUS <> 2 	/*union with all Plant LEDGERCODES turned on at borg level*/ 	UNION ALL 	select null CONTRID, null DIVID, PLANTANDEQ.PEID PEID, LEDGERCODES.LEDGERID, LEDGERCODES.LEDGERALLOC ALLOC, LCGH.SYS, BORGS.BORGID 	from BORGS 	inner join PLANTANDEQ on PLANTANDEQ.BORGID = BORGS.BORGID 	inner join LEDGERCODEGROUPLINK LCGL on LCGL.THEID = BORGS.BORGID and LCGL.LEV = 1 	inner join LEDGERCODEGROUPDETAIL LCGD on LCGL.HID = LCGD.HID and LCGD.TYPE = 'LED' 	inner join LEDGERCODEGROUPHEADER LCGH on LCGL.HID = LCGH.ID 	inner join LEDGERCODES on LCGD.TID = LEDGERCODES.LEDGERID 	WHERE LCGL.INC = 1 	AND LCGH.ALLOC = 'Plant' 	AND LEDGERCODES.LEDGERALLOC = 'Plant' 	AND PLANTANDEQ.PESTATUS <> 2 	/*------------------------Include at level 2------------------------*/ 	/*union with all Contract LEDGERCODES turned on at project level*/ 	UNION ALL 	select CONTRACTS.CONTRID CONTRID, null DIVID, null PEID, LEDGERCODES.LEDGERID, LEDGERCODES.LEDGERALLOC ALLOC, LCGH.SYS, BORGS.BORGID 	from BORGS 	inner join PROJECTS on PROJECTS.BORGID = BORGS.BORGID 	inner join CONTRACTS on CONTRACTS.PROJID = PROJECTS.PROJID 	inner join LEDGERCODEGROUPLINK LCGL on LCGL.THEID = PROJECTS.PROJID and LCGL.LEV = 2 	inner join LEDGERCODEGROUPDETAIL LCGD on LCGL.HID = LCGD.HID and LCGD.TYPE = 'LED' 	inner join LEDGERCODEGROUPHEADER LCGH on LCGL.HID = LCGH.ID 	inner join LEDGERCODES on LCGD.TID = LEDGERCODES.LEDGERID 	WHERE LCGL.INC = 1 	AND LCGH.ALLOC = 'Contracts' 	AND LEDGERCODES.LEDGERALLOC = 'Contracts' 	AND CONTRACTS.CONSTATUS <> 2 	/*union with all Overheads LEDGERCODES turned on at division level*/ 	UNION ALL 	select null CONTRID, DIVISIONS.DIVID DIVID, null PEID, LEDGERCODES.LEDGERID, LEDGERCODES.LEDGERALLOC ALLOC, LCGH.SYS, BORGS.BORGID 	from BORGS 	inner join DIVISIONS on DIVISIONS.BORGID = BORGS.BORGID 	inner join LEDGERCODEGROUPLINK LCGL on LCGL.THEID = DIVISIONS.DIVID and LCGL.LEV = 2 	inner join LEDGERCODEGROUPDETAIL LCGD on LCGL.HID = LCGD.HID and LCGD.TYPE = 'LED' 	inner join LEDGERCODEGROUPHEADER LCGH on LCGL.HID = LCGH.ID 	inner join LEDGERCODES on LCGD.TID = LEDGERCODES.LEDGERID 	WHERE LCGL.INC = 1 	AND LCGH.ALLOC = 'Overheads' 	AND LEDGERCODES.LEDGERALLOC = 'Overheads' 	AND DIVISIONS.DIVSTATUS <> 2 	/*union with all Plant LEDGERCODES turned on at plant level*/ 	UNION ALL 	select null CONTRID, null DIVID, PLANTANDEQ.PEID PEID, LEDGERCODES.LEDGERID, LEDGERCODES.LEDGERALLOC ALLOC, LCGH.SYS, BORGS.BORGID 	from BORGS 	inner join PLANTANDEQ on PLANTANDEQ.BORGID = BORGS.BORGID 	inner join LEDGERCODEGROUPLINK LCGL on LCGL.THEID = PLANTANDEQ.PEID and LCGL.LEV = 2 	inner join LEDGERCODEGROUPDETAIL LCGD on LCGL.HID = LCGD.HID and LCGD.TYPE = 'LED' 	inner join LEDGERCODEGROUPHEADER LCGH on LCGL.HID = LCGH.ID 	inner join LEDGERCODES on LCGD.TID = LEDGERCODES.LEDGERID 	WHERE LCGL.INC = 1 	AND LCGH.ALLOC = 'Plant' 	AND LEDGERCODES.LEDGERALLOC = 'Plant' 	AND PLANTANDEQ.PESTATUS <> 2 	/*------------------------Include at level 3------------------------*/ 	 /*union with all Contract LEDGERCODES turned on at contract level*/ 	UNION ALL 	select CONTRACTS.CONTRID CONTRID, null DIVID, null PEID, LEDGERCODES.LEDGERID, LEDGERCODES.LEDGERALLOC ALLOC, LCGH.SYS, BORGS.BORGID 	from BORGS 	inner join PROJECTS on PROJECTS.BORGID = BORGS.BORGID 	inner join CONTRACTS on CONTRACTS.PROJID = PROJECTS.PROJID 	inner join LEDGERCODEGROUPLINK LCGL on LCGL.THEID = CONTRACTS.CONTRID and LCGL.LEV = 3 	inner join LEDGERCODEGROUPDETAIL LCGD on LCGL.HID = LCGD.HID and LCGD.TYPE = 'LED' 	inner join LEDGERCODEGROUPHEADER LCGH on LCGL.HID = LCGH.ID 	inner join LEDGERCODES on LCGD.TID = LEDGERCODES.LEDGERID 	WHERE LCGL.INC = 1 	AND LCGH.ALLOC = 'Contracts' 	AND LEDGERCODES.LEDGERALLOC = 'Contracts' 	AND CONTRACTS.CONSTATUS <> 2 ) as TABLEINCLUDE left outer join ( 	/*------------------------Excludes at level 0------------------------*/ 	/*select all Balance Sheet LEDGERCODES excluded at group level, not included at borg level*/ 	select null CONTRID, null DIVID, null PEID, LEDGERCODES.LEDGERID, LEDGERCODES.LEDGERALLOC ALLOC, LCGH.SYS, NULL BORGID 	from LEDGERCODEGROUPLINK LCGL 	inner join LEDGERCODEGROUPDETAIL LCGD on LCGL.HID = LCGD.HID and LCGD.TYPE = 'LED' 	inner join LEDGERCODEGROUPHEADER LCGH on LCGL.HID = LCGH.ID 	inner join LEDGERCODES on LCGD.TID = LEDGERCODES.LEDGERID 	left outer join ( 		select LEDGERCODES.LEDGERID, LEDGERCODES.LEDGERALLOC ALLOC, LCGH.SYS 		from BORGS 		inner join LEDGERCODEGROUPLINK LCGL on LCGL.THEID = BORGS.BORGID and LCGL.LEV = 1 		inner join LEDGERCODEGROUPDETAIL LCGD on LCGL.HID = LCGD.HID and LCGD.TYPE = 'LED' 		inner join LEDGERCODEGROUPHEADER LCGH on LCGL.HID = LCGH.ID 		inner join LEDGERCODES on LCGD.TID = LEDGERCODES.LEDGERID 		WHERE LCGL.INC = 0 		AND LCGH.ALLOC = 'Balance Sheet' 		AND LEDGERCODES.LEDGERALLOC = 'Balance Sheet' 	) IB 	ON IB.LEDGERID = LEDGERCODES.LEDGERID 	and IB.SYS = LCGH.SYS 	WHERE LCGL.LEV = 0 	AND LCGL.INC = 0 	and IB.LEDGERID is null 	AND LCGH.ALLOC = 'Balance Sheet' 	AND LEDGERCODES.LEDGERALLOC = 'Balance Sheet' 	/*select all Contract LEDGERCODES excluded at group level, not included at borg or project or contract level*/ 	UNION ALL 	select CONTRACTS.CONTRID CONTRID, null DIVID, null PEID, LEDGERCODES.LEDGERID, LEDGERCODES.LEDGERALLOC ALLOC, LCGH.SYS, BORGS.BORGID 	from BORGS 	inner join PROJECTS on PROJECTS.BORGID = BORGS.BORGID 	inner join CONTRACTS on CONTRACTS.PROJID = PROJECTS.PROJID 	inner join LEDGERCODEGROUPLINK LCGL on LCGL.LEV = 0 	inner join LEDGERCODEGROUPDETAIL LCGD on LCGL.HID = LCGD.HID and LCGD.TYPE = 'LED' 	inner join LEDGERCODEGROUPHEADER LCGH on LCGL.HID = LCGH.ID 	inner join LEDGERCODES on LCGD.TID = LEDGERCODES.LEDGERID 	left outer join ( 		select CONTRACTS.CONTRID, LEDGERCODES.LEDGERID, LCGH.SYS, BORGS.BORGID 		from BORGS 		inner join PROJECTS on PROJECTS.BORGID = BORGS.BORGID 		inner join CONTRACTS on CONTRACTS.PROJID = PROJECTS.PROJID 		inner join LEDGERCODEGROUPLINK LCGL on LCGL.THEID = CONTRACTS.CONTRID and LCGL.LEV = 3 		inner join LEDGERCODEGROUPDETAIL LCGD on LCGL.HID = LCGD.HID and LCGD.TYPE = 'LED' 		inner join LEDGERCODEGROUPHEADER LCGH on LCGL.HID = LCGH.ID 		inner join LEDGERCODES on LCGD.TID = LEDGERCODES.LEDGERID 		WHERE LCGL.INC = 1 		AND LCGH.ALLOC = 'Contracts' 		AND LEDGERCODES.LEDGERALLOC = 'Contracts' 		AND CONTRACTS.CONSTATUS <> 2 	) IC 	on IC.CONTRID = CONTRACTS.CONTRID 	and IC.LEDGERID = LEDGERCODES.LEDGERID 	and IC.SYS = LCGH.SYS 	left outer join ( 		select CONTRACTS.CONTRID, LEDGERCODES.LEDGERID, LCGH.SYS, BORGS.BORGID 		from BORGS 		inner join PROJECTS on PROJECTS.BORGID = BORGS.BORGID 		inner join CONTRACTS on CONTRACTS.PROJID = PROJECTS.PROJID 		inner join LEDGERCODEGROUPLINK LCGL on LCGL.THEID = PROJECTS.PROJID and LCGL.LEV = 2 		inner join LEDGERCODEGROUPDETAIL LCGD on LCGL.HID = LCGD.HID and LCGD.TYPE = 'LED' 		inner join LEDGERCODEGROUPHEADER LCGH on LCGL.HID = LCGH.ID 		inner join LEDGERCODES on LCGD.TID = LEDGERCODES.LEDGERID 		WHERE LCGL.INC = 1 		AND LCGH.ALLOC = 'Contracts' 		AND LEDGERCODES.LEDGERALLOC = 'Contracts' 		AND CONTRACTS.CONSTATUS <> 2 	) IP 	on IP.CONTRID = CONTRACTS.CONTRID 	and IP.LEDGERID = LEDGERCODES.LEDGERID 	and IP.SYS = LCGH.SYS 	left outer join ( 		select CONTRACTS.CONTRID, LEDGERCODES.LEDGERID, LCGH.SYS, BORGS.BORGID 		from BORGS 		inner join PROJECTS on PROJECTS.BORGID = BORGS.BORGID 		inner join CONTRACTS on CONTRACTS.PROJID = PROJECTS.PROJID 		inner join LEDGERCODEGROUPLINK LCGL on LCGL.THEID = BORGS.BORGID and LCGL.LEV = 1 		inner join LEDGERCODEGROUPDETAIL LCGD on LCGL.HID = LCGD.HID and LCGD.TYPE = 'LED' 		inner join LEDGERCODEGROUPHEADER LCGH on LCGL.HID = LCGH.ID 		inner join LEDGERCODES on LCGD.TID = LEDGERCODES.LEDGERID 		WHERE LCGL.INC = 1 		AND LCGH.ALLOC = 'Contracts' 		AND LEDGERCODES.LEDGERALLOC = 'Contracts' 		AND CONTRACTS.CONSTATUS <> 2 	) IB 	on IB.CONTRID = CONTRACTS.CONTRID 	and IB.LEDGERID = LEDGERCODES.LEDGERID 	and IB.SYS = LCGH.SYS 	WHERE LCGL.INC = 0 	and IC.LEDGERID is null 	and IP.LEDGERID is null 	and IB.LEDGERID is null 	AND LCGH.ALLOC = 'Contracts' 	AND LEDGERCODES.LEDGERALLOC = 'Contracts' 	/*select all Overhead LEDGERCODES excluded at group level, not included at borg or division level*/ 	UNION ALL 	select null CONTRID, DIVISIONS.DIVID DIVID, null PEID, LEDGERCODES.LEDGERID, LEDGERCODES.LEDGERALLOC ALLOC, LCGH.SYS, BORGS.BORGID 	from BORGS 	inner join DIVISIONS on DIVISIONS.BORGID = BORGS.BORGID 	inner join LEDGERCODEGROUPLINK LCGL on LCGL.LEV = 0 	inner join LEDGERCODEGROUPDETAIL LCGD on LCGL.HID = LCGD.HID and LCGD.TYPE = 'LED' 	inner join LEDGERCODEGROUPHEADER LCGH on LCGL.HID = LCGH.ID 	inner join LEDGERCODES on LCGD.TID = LEDGERCODES.LEDGERID 	left outer join ( 		select DIVISIONS.DIVID, LEDGERCODES.LEDGERID, LCGH.SYS, BORGS.BORGID 		from BORGS 		inner join DIVISIONS on DIVISIONS.BORGID = BORGS.BORGID 		inner join LEDGERCODEGROUPLINK LCGL on LCGL.THEID = DIVISIONS.DIVID and LCGL.LEV = 2 		inner join LEDGERCODEGROUPDETAIL LCGD on LCGL.HID = LCGD.HID and LCGD.TYPE = 'LED' 		inner join LEDGERCODEGROUPHEADER LCGH on LCGL.HID = LCGH.ID 		inner join LEDGERCODES on LCGD.TID = LEDGERCODES.LEDGERID 		WHERE LCGL.INC = 1 		AND LCGH.ALLOC = 'Overheads' 		AND LEDGERCODES.LEDGERALLOC = 'Overheads' 		AND DIVISIONS.DIVSTATUS <> 2 	) ID 	on ID.DIVID = DIVISIONS.DIVID 	and ID.LEDGERID = LEDGERCODES.LEDGERID 	and ID.SYS = LCGH.SYS 	left outer join ( 		select DIVISIONS.DIVID, LEDGERCODES.LEDGERID, LCGH.SYS, BORGS.BORGID 		from BORGS 		inner join DIVISIONS on DIVISIONS.BORGID = BORGS.BORGID 		inner join LEDGERCODEGROUPLINK LCGL on LCGL.THEID = BORGS.BORGID and LCGL.LEV = 1 		inner join LEDGERCODEGROUPDETAIL LCGD on LCGL.HID = LCGD.HID and LCGD.TYPE = 'LED' 		inner join LEDGERCODEGROUPHEADER LCGH on LCGL.HID = LCGH.ID 		inner join LEDGERCODES on LCGD.TID = LEDGERCODES.LEDGERID 		WHERE LCGL.INC = 1 		AND LCGH.ALLOC = 'Overheads' 		AND LEDGERCODES.LEDGERALLOC = 'Overheads' 		AND DIVISIONS.DIVSTATUS <> 2 	) IB 	on IB.DIVID = DIVISIONS.DIVID 	and IB.LEDGERID = LEDGERCODES.LEDGERID 	and IB.SYS = LCGH.SYS 	WHERE LCGL.INC = 0 	and ID.LEDGERID is null 	and IB.LEDGERID is null 	AND LCGH.ALLOC = 'Overheads' 	AND LEDGERCODES.LEDGERALLOC = 'Overheads' 	/*select all Plant LEDGERCODES excluded at group level, not included at borg or plant level*/ 	UNION ALL 	select null CONTRID, null DIVID, PLANTANDEQ.PEID PEID, LEDGERCODES.LEDGERID, LEDGERCODES.LEDGERALLOC ALLOC, LCGH.SYS, BORGS.BORGID 	from BORGS 	inner join PLANTANDEQ on PLANTANDEQ.BORGID = BORGS.BORGID 	inner join LEDGERCODEGROUPLINK LCGL on LCGL.LEV = 0 	inner join LEDGERCODEGROUPDETAIL LCGD on LCGL.HID = LCGD.HID and LCGD.TYPE = 'LED' 	inner join LEDGERCODEGROUPHEADER LCGH on LCGL.HID = LCGH.ID 	inner join LEDGERCODES on LCGD.TID = LEDGERCODES.LEDGERID 	left outer join ( 		select PLANTANDEQ.PEID, LEDGERCODES.LEDGERID, LCGH.SYS, BORGS.BORGID 		from BORGS 		inner join PLANTANDEQ on PLANTANDEQ.BORGID = BORGS.BORGID 		inner join LEDGERCODEGROUPLINK LCGL on LCGL.THEID = PLANTANDEQ.DIVID and LCGL.LEV = 2 		inner join LEDGERCODEGROUPDETAIL LCGD on LCGL.HID = LCGD.HID and LCGD.TYPE = 'LED' 		inner join LEDGERCODEGROUPHEADER LCGH on LCGL.HID = LCGH.ID 		inner join LEDGERCODES on LCGD.TID = LEDGERCODES.LEDGERID 		WHERE LCGL.INC = 1 		AND LCGH.ALLOC = 'Plant' 		AND LEDGERCODES.LEDGERALLOC = 'Plant' 		AND PLANTANDEQ.PESTATUS <> 2 	) ID 	on ID.PEID = PLANTANDEQ.PEID 	and ID.LEDGERID = LEDGERCODES.LEDGERID 	and ID.SYS = LCGH.SYS 	left outer join ( 		select PLANTANDEQ.PEID, LEDGERCODES.LEDGERID, LCGH.SYS, BORGS.BORGID 		from BORGS 		inner join PLANTANDEQ on PLANTANDEQ.BORGID = BORGS.BORGID 		inner join LEDGERCODEGROUPLINK LCGL on LCGL.THEID = BORGS.BORGID and LCGL.LEV = 1 		inner join LEDGERCODEGROUPDETAIL LCGD on LCGL.HID = LCGD.HID and LCGD.TYPE = 'LED' 		inner join LEDGERCODEGROUPHEADER LCGH on LCGL.HID = LCGH.ID 		inner join LEDGERCODES on LCGD.TID = LEDGERCODES.LEDGERID 		WHERE LCGL.INC = 1 		AND LCGH.ALLOC = 'Plant' 		AND LEDGERCODES.LEDGERALLOC = 'Plant' 		AND PLANTANDEQ.PESTATUS <> 2 	) IB 	on IB.PEID = PLANTANDEQ.PEID 	and IB.LEDGERID = LEDGERCODES.LEDGERID 	and IB.SYS = LCGH.SYS 	WHERE LCGL.INC = 0 	and ID.LEDGERID is null 	and IB.LEDGERID is null 	AND LCGH.ALLOC = 'Plant' 	AND LEDGERCODES.LEDGERALLOC = 'Plant' 	/*------------------------Excludes at level 1------------------------*/ 	/*select all Balance Sheet LEDGERCODES excluded at borg level*/ 	UNION ALL 	select null CONTRID, null DIVID, null PEID, LEDGERCODES.LEDGERID, LEDGERCODES.LEDGERALLOC ALLOC, LCGH.SYS, BORGS.BORGID 	from BORGS 	inner join LEDGERCODEGROUPLINK LCGL on LCGL.THEID = BORGS.BORGID and LCGL.LEV = 1 	inner join LEDGERCODEGROUPDETAIL LCGD on LCGL.HID = LCGD.HID and LCGD.TYPE = 'LED' 	inner join LEDGERCODEGROUPHEADER LCGH on LCGL.HID = LCGH.ID 	inner join LEDGERCODES on LCGD.TID = LEDGERCODES.LEDGERID 	WHERE LCGL.INC = 0 	AND LCGH.ALLOC = 'Balance Sheet' 	AND LEDGERCODES.LEDGERALLOC = 'Balance Sheet' 	/*select all Contract LEDGERCODES excluded at borg level, not included at project or contract level*/ 	UNION ALL 	select CONTRACTS.CONTRID CONTRID, null DIVID, null PEID, LEDGERCODES.LEDGERID, LEDGERCODES.LEDGERALLOC ALLOC, LCGH.SYS, BORGS.BORGID 	from BORGS 	inner join PROJECTS on PROJECTS.BORGID = BORGS.BORGID 	inner join CONTRACTS on CONTRACTS.PROJID = PROJECTS.PROJID 	inner join LEDGERCODEGROUPLINK LCGL on LCGL.THEID = BORGS.BORGID and LCGL.LEV = 1 	inner join LEDGERCODEGROUPDETAIL LCGD on LCGL.HID = LCGD.HID and LCGD.TYPE = 'LED' 	inner join LEDGERCODEGROUPHEADER LCGH on LCGL.HID = LCGH.ID 	inner join LEDGERCODES on LCGD.TID = LEDGERCODES.LEDGERID 	left outer join ( 		select CONTRACTS.CONTRID, LEDGERCODES.LEDGERID, LCGH.SYS, BORGS.BORGID 		from BORGS 		inner join PROJECTS on PROJECTS.BORGID = BORGS.BORGID 		inner join CONTRACTS on CONTRACTS.PROJID = PROJECTS.PROJID 		inner join LEDGERCODEGROUPLINK LCGL on LCGL.THEID = CONTRACTS.CONTRID and LCGL.LEV = 3 		inner join LEDGERCODEGROUPDETAIL LCGD on LCGL.HID = LCGD.HID and LCGD.TYPE = 'LED' 		inner join LEDGERCODEGROUPHEADER LCGH on LCGL.HID = LCGH.ID 		inner join LEDGERCODES on LCGD.TID = LEDGERCODES.LEDGERID 		WHERE LCGL.INC = 1 		AND LCGH.ALLOC = 'Contracts' 		AND LEDGERCODES.LEDGERALLOC = 'Contracts' 		AND CONTRACTS.CONSTATUS <> 2 	) IC 	on IC.CONTRID = CONTRACTS.CONTRID 	and IC.LEDGERID = LEDGERCODES.LEDGERID 	and IC.SYS = LCGH.SYS 	left outer join ( 		select CONTRACTS.CONTRID, LEDGERCODES.LEDGERID, LCGH.SYS, BORGS.BORGID 		from BORGS 		inner join PROJECTS on PROJECTS.BORGID = BORGS.BORGID 		inner join CONTRACTS on CONTRACTS.PROJID = PROJECTS.PROJID 		inner join LEDGERCODEGROUPLINK LCGL on LCGL.THEID = PROJECTS.PROJID and LCGL.LEV = 2 		inner join LEDGERCODEGROUPDETAIL LCGD on LCGL.HID = LCGD.HID and LCGD.TYPE = 'LED' 		inner join LEDGERCODEGROUPHEADER LCGH on LCGL.HID = LCGH.ID 		inner join LEDGERCODES on LCGD.TID = LEDGERCODES.LEDGERID 		WHERE LCGL.INC = 1 		AND LCGH.ALLOC = 'Contracts' 		AND LEDGERCODES.LEDGERALLOC = 'Contracts' 		AND CONTRACTS.CONSTATUS <> 2 	) IP 	on IP.CONTRID = CONTRACTS.CONTRID 	and IP.LEDGERID = LEDGERCODES.LEDGERID 	and IP.SYS = LCGH.SYS 	WHERE LCGL.INC = 0 	and IC.LEDGERID is null 	and IP.LEDGERID is null 	AND LCGH.ALLOC = 'Contracts' 	AND LEDGERCODES.LEDGERALLOC = 'Contracts' 	/*select all Overhead LEDGERCODES excluded at borg level, not included at division level*/ 	UNION ALL 	select null CONTRID, DIVISIONS.DIVID DIVID, null PEID, LEDGERCODES.LEDGERID, LEDGERCODES.LEDGERALLOC ALLOC, LCGH.SYS, BORGS.BORGID 	from BORGS 	inner join DIVISIONS on DIVISIONS.BORGID = BORGS.BORGID 	inner join LEDGERCODEGROUPLINK LCGL on LCGL.THEID = BORGS.BORGID and LCGL.LEV = 1 	inner join LEDGERCODEGROUPDETAIL LCGD on LCGL.HID = LCGD.HID and LCGD.TYPE = 'LED' 	inner join LEDGERCODEGROUPHEADER LCGH on LCGL.HID = LCGH.ID 	inner join LEDGERCODES on LCGD.TID = LEDGERCODES.LEDGERID 	left outer join ( 		select DIVISIONS.DIVID, LEDGERCODES.LEDGERID, LCGH.SYS, BORGS.BORGID 		from BORGS 		inner join DIVISIONS on DIVISIONS.BORGID = BORGS.BORGID 		inner join LEDGERCODEGROUPLINK LCGL on LCGL.THEID = DIVISIONS.DIVID and LCGL.LEV = 2 		inner join LEDGERCODEGROUPDETAIL LCGD on LCGL.HID = LCGD.HID and LCGD.TYPE = 'LED' 		inner join LEDGERCODEGROUPHEADER LCGH on LCGL.HID = LCGH.ID 		inner join LEDGERCODES on LCGD.TID = LEDGERCODES.LEDGERID 		WHERE LCGL.INC = 1 		AND LCGH.ALLOC = 'OVERHEADS' 		AND LEDGERCODES.LEDGERALLOC = 'OVERHEADS' 		AND DIVISIONS.DIVSTATUS <> 2 	) ID 	on ID.DIVID = DIVISIONS.DIVID 	and ID.LEDGERID = LEDGERCODES.LEDGERID 	and ID.SYS = LCGH.SYS 	WHERE LCGL.INC = 0 	and ID.LEDGERID is null 	AND LCGH.ALLOC = 'OVERHEADS' 	AND LEDGERCODES.LEDGERALLOC = 'OVERHEADS' 	/*select all Plant LEDGERCODES excluded at borg level, not included at plant level*/ 	UNION ALL 	select null CONTRID, null DIVID, PLANTANDEQ.PEID PEID, LEDGERCODES.LEDGERID, LEDGERCODES.LEDGERALLOC ALLOC, LCGH.SYS, BORGS.BORGID 	from BORGS 	inner join PLANTANDEQ on PLANTANDEQ.BORGID = BORGS.BORGID 	inner join LEDGERCODEGROUPLINK LCGL on LCGL.THEID = BORGS.BORGID and LCGL.LEV = 1 	inner join LEDGERCODEGROUPDETAIL LCGD on LCGL.HID = LCGD.HID and LCGD.TYPE = 'LED' 	inner join LEDGERCODEGROUPHEADER LCGH on LCGL.HID = LCGH.ID 	inner join LEDGERCODES on LCGD.TID = LEDGERCODES.LEDGERID 	left outer join ( 		select PLANTANDEQ.PEID PEID, LEDGERCODES.LEDGERID, LCGH.SYS, BORGS.BORGID 		from BORGS 		inner join PLANTANDEQ on PLANTANDEQ.BORGID = BORGS.BORGID 		inner join LEDGERCODEGROUPLINK LCGL on LCGL.THEID = PLANTANDEQ.PEID and LCGL.LEV = 2 		inner join LEDGERCODEGROUPDETAIL LCGD on LCGL.HID = LCGD.HID and LCGD.TYPE = 'LED' 		inner join LEDGERCODEGROUPHEADER LCGH on LCGL.HID = LCGH.ID 		inner join LEDGERCODES on LCGD.TID = LEDGERCODES.LEDGERID 		WHERE LCGL.INC = 1 		AND LCGH.ALLOC = 'Plant' 		AND LEDGERCODES.LEDGERALLOC = 'Plant' 		AND PLANTANDEQ.PESTATUS <> 2 	) IP 	on IP.PEID = PLANTANDEQ.PEID 	and IP.LEDGERID = LEDGERCODES.LEDGERID 	and IP.SYS = LCGH.SYS 	WHERE LCGL.INC = 0 	and IP.LEDGERID is null 	AND LCGH.ALLOC = 'Plant' 	AND LEDGERCODES.LEDGERALLOC = 'Plant' 	/*------------------------Excludes at level 2------------------------*/ 	/*select all Contract LEDGERCODES excluded at project level, not included at contract level*/ 	UNION ALL 	select CONTRACTS.CONTRID CONTRID, null DIVID, null PEID, LEDGERCODES.LEDGERID, LEDGERCODES.LEDGERALLOC ALLOC, LCGH.SYS, BORGS.BORGID 	from BORGS 	inner join PROJECTS on PROJECTS.BORGID = BORGS.BORGID 	inner join CONTRACTS on CONTRACTS.PROJID = PROJECTS.PROJID 	inner join LEDGERCODEGROUPLINK LCGL on LCGL.THEID = PROJECTS.PROJID and LCGL.LEV = 2 	inner join LEDGERCODEGROUPDETAIL LCGD on LCGL.HID = LCGD.HID and LCGD.TYPE = 'LED' 	inner join LEDGERCODEGROUPHEADER LCGH on LCGL.HID = LCGH.ID 	inner join LEDGERCODES on LCGD.TID = LEDGERCODES.LEDGERID 	left outer join ( 		select CONTRACTS.CONTRID, LEDGERCODES.LEDGERID, LCGH.SYS, BORGS.BORGID 		from BORGS 		inner join PROJECTS on PROJECTS.BORGID = BORGS.BORGID 		inner join CONTRACTS on CONTRACTS.PROJID = PROJECTS.PROJID 		inner join LEDGERCODEGROUPLINK LCGL on LCGL.THEID = CONTRACTS.CONTRID and LCGL.LEV = 3 		inner join LEDGERCODEGROUPDETAIL LCGD on LCGL.HID = LCGD.HID and LCGD.TYPE = 'LED' 		inner join LEDGERCODEGROUPHEADER LCGH on LCGL.HID = LCGH.ID 		inner join LEDGERCODES on LCGD.TID = LEDGERCODES.LEDGERID 		WHERE LCGL.INC = 1 		AND LCGH.ALLOC = 'Contracts' 		AND LEDGERCODES.LEDGERALLOC = 'Contracts' 		AND CONTRACTS.CONSTATUS <> 2 	) IA 	on IA.CONTRID = CONTRACTS.CONTRID 	and IA.LEDGERID = LEDGERCODES.LEDGERID 	and IA.SYS = LCGH.SYS 	AND LCGH.ALLOC = 'Contracts' 	AND LEDGERCODES.LEDGERALLOC = 'Contracts' 	WHERE LCGL.INC = 0 	and IA.LEDGERID is null 	/*select all Overhead LEDGERCODES excluded at divid level*/ 	UNION ALL 	select null CONTRID, DIVISIONS.DIVID DIVID, null PEID, LEDGERCODES.LEDGERID, LEDGERCODES.LEDGERALLOC ALLOC, LCGH.SYS, BORGS.BORGID 	from BORGS 	inner join DIVISIONS on DIVISIONS.BORGID = BORGS.BORGID 	inner join LEDGERCODEGROUPLINK LCGL on LCGL.THEID = DIVISIONS.DIVID and LCGL.LEV = 2 	inner join LEDGERCODEGROUPDETAIL LCGD on LCGL.HID = LCGD.HID and LCGD.TYPE = 'LED' 	inner join LEDGERCODEGROUPHEADER LCGH on LCGL.HID = LCGH.ID 	inner join LEDGERCODES on LCGD.TID = LEDGERCODES.LEDGERID 	WHERE LCGL.INC = 0 	AND LCGH.ALLOC = 'Overheads' 	AND LEDGERCODES.LEDGERALLOC = 'Overheads' 	AND DIVISIONS.DIVSTATUS <> 2 	/*select all Plant LEDGERCODES excluded at divid level*/ 	UNION ALL 	select null CONTRID, null DIVID, PLANTANDEQ.PEID PEID, LEDGERCODES.LEDGERID, LEDGERCODES.LEDGERALLOC ALLOC, LCGH.SYS, BORGS.BORGID 	from BORGS 	inner join PLANTANDEQ on PLANTANDEQ.BORGID = BORGS.BORGID 	inner join LEDGERCODEGROUPLINK LCGL on LCGL.THEID = PLANTANDEQ.PEID and LCGL.LEV = 2 	inner join LEDGERCODEGROUPDETAIL LCGD on LCGL.HID = LCGD.HID and LCGD.TYPE = 'LED' 	inner join LEDGERCODEGROUPHEADER LCGH on LCGL.HID = LCGH.ID 	inner join LEDGERCODES on LCGD.TID = LEDGERCODES.LEDGERID 	WHERE LCGL.INC = 0 	AND LCGH.ALLOC = 'Plant' 	AND LEDGERCODES.LEDGERALLOC = 'Plant' 	AND PLANTANDEQ.PESTATUS <> 2 	/*------------------------Excludes at level 3------------------------*/ 	/*select all Contract LEDGERCODES excluded at contract level*/ 	UNION ALL 	select CONTRACTS.CONTRID CONTRID, null DIVID, null PEID, LEDGERCODES.LEDGERID, LEDGERCODES.LEDGERALLOC ALLOC, LCGH.SYS, BORGS.BORGID 	from BORGS 	inner join PROJECTS on PROJECTS.BORGID = BORGS.BORGID 	inner join CONTRACTS on CONTRACTS.PROJID = PROJECTS.PROJID 	inner join LEDGERCODEGROUPLINK LCGL on LCGL.THEID = CONTRACTS.CONTRID and LCGL.LEV = 3 	inner join LEDGERCODEGROUPDETAIL LCGD on LCGL.HID = LCGD.HID and LCGD.TYPE = 'LED' 	inner join LEDGERCODEGROUPHEADER LCGH on LCGL.HID = LCGH.ID 	inner join LEDGERCODES on LCGD.TID = LEDGERCODES.LEDGERID 	WHERE LCGL.INC = 0 	AND LCGH.ALLOC = 'Contracts' 	AND LEDGERCODES.LEDGERALLOC = 'Contracts' ) as TABLEEXCLUDE on TABLEINCLUDE.CONTRID = TABLEEXCLUDE.CONTRID AND TABLEINCLUDE.LEDGERID = TABLEEXCLUDE.LEDGERID AND TABLEINCLUDE.SYS = TABLEEXCLUDE.SYS AND TABLEINCLUDE.ALLOC = TABLEEXCLUDE.ALLOC WHERE TABLEEXCLUDE.LEDGERID IS NULL AND TABLEEXCLUDE.SYS IS NULL 