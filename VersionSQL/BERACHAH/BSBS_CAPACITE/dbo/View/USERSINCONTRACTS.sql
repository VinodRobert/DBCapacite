/****** Object:  View [dbo].[USERSINCONTRACTS]    Committed by VersionSQL https://www.versionsql.com ******/

  CREATE VIEW USERSINCONTRACTS  AS  SELECT DISTINCT TABLEINCLUDE.CONTRID, TABLEINCLUDE.USERID  FROM  (  	select CONTRACTS.CONTRID, USERS.USERID  	from BORGS  	inner join PROJECTS on PROJECTS.BORGID = BORGS.BORGID  	inner join CONTRACTS on CONTRACTS.PROJID = PROJECTS.PROJID  	CROSS JOIN USERS  	left outer join USERCONTRACTS  	on USERCONTRACTS.USERID = USERS.USERID  	WHERE CONTRACTS.CONSTATUS <> 2  	AND ((USERCONTRACTS.LEV = 0 and USERCONTRACTS.INC = 1) OR (USERCONTRACTS.USERID is null))  	UNION ALL  	select CONTRACTS.CONTRID, USERCONTRACTS.USERID  	from BORGS  	inner join PROJECTS on PROJECTS.BORGID = BORGS.BORGID  	inner join CONTRACTS on CONTRACTS.PROJID = PROJECTS.PROJID  	inner join USERCONTRACTS on USERCONTRACTS.THEID = BORGS.BORGID and USERCONTRACTS.LEV = 1  	WHERE USERCONTRACTS.INC = 1  	AND CONTRACTS.CONSTATUS <> 2  	UNION ALL  	select CONTRACTS.CONTRID, USERCONTRACTS.USERID  	from BORGS  	inner join PROJECTS on PROJECTS.BORGID = BORGS.BORGID  	inner join CONTRACTS on CONTRACTS.PROJID = PROJECTS.PROJID  	inner join USERCONTRACTS on USERCONTRACTS.THEID = PROJECTS.PROJID and USERCONTRACTS.LEV = 2  	WHERE USERCONTRACTS.INC = 1  	AND CONTRACTS.CONSTATUS <> 2  	UNION ALL  	select CONTRACTS.CONTRID, USERCONTRACTS.USERID  	from BORGS  	inner join PROJECTS on PROJECTS.BORGID = BORGS.BORGID  	inner join CONTRACTS on CONTRACTS.PROJID = PROJECTS.PROJID  	inner join USERCONTRACTS on USERCONTRACTS.THEID = CONTRACTS.CONTRID and USERCONTRACTS.LEV = 3  	WHERE USERCONTRACTS.INC = 1  	AND CONTRACTS.CONSTATUS <> 2  ) as TABLEINCLUDE  left outer join  (  	select CONTRACTS.CONTRID, USERCONTRACTS.USERID  	from BORGS  	inner join PROJECTS on PROJECTS.BORGID = BORGS.BORGID  	inner join CONTRACTS on CONTRACTS.PROJID = PROJECTS.PROJID  	inner join USERCONTRACTS on USERCONTRACTS.THEID = BORGS.BORGID and USERCONTRACTS.LEV = 1  	left outer join (  		select CONTRACTS.CONTRID, USERCONTRACTS.USERID  		from BORGS  		inner join PROJECTS on PROJECTS.BORGID = BORGS.BORGID  		inner join CONTRACTS on CONTRACTS.PROJID = PROJECTS.PROJID  		inner join USERCONTRACTS on USERCONTRACTS.THEID = CONTRACTS.CONTRID and USERCONTRACTS.LEV = 3  		WHERE USERCONTRACTS.INC = 1  	) INCLUDEDCONTRACTS  	on CONTRACTS.CONTRID = INCLUDEDCONTRACTS.CONTRID  	and USERCONTRACTS.USERID = INCLUDEDCONTRACTS.USERID  	left outer join (  		select CONTRACTS.CONTRID, USERCONTRACTS.USERID  		from BORGS  		inner join PROJECTS on PROJECTS.BORGID = BORGS.BORGID  		inner join CONTRACTS on CONTRACTS.PROJID = PROJECTS.PROJID  		inner join USERCONTRACTS on USERCONTRACTS.THEID = PROJECTS.PROJID and USERCONTRACTS.LEV = 2  		WHERE USERCONTRACTS.INC = 1  	) INCLUDEDPROJECTS  	on CONTRACTS.CONTRID = INCLUDEDPROJECTS.CONTRID  	and USERCONTRACTS.USERID = INCLUDEDPROJECTS.USERID  	WHERE USERCONTRACTS.INC = 0  	and INCLUDEDCONTRACTS.CONTRID is null  	and INCLUDEDPROJECTS.CONTRID is null  	UNION ALL  	select CONTRACTS.CONTRID, USERCONTRACTS.USERID  	from BORGS  	inner join PROJECTS on PROJECTS.BORGID = BORGS.BORGID  	inner join CONTRACTS on CONTRACTS.PROJID = PROJECTS.PROJID  	inner join USERCONTRACTS on USERCONTRACTS.THEID = PROJECTS.PROJID and USERCONTRACTS.LEV = 2  	left outer join (  		select CONTRACTS.CONTRID, USERCONTRACTS.USERID  		from BORGS  		inner join PROJECTS on PROJECTS.BORGID = BORGS.BORGID  		inner join CONTRACTS on CONTRACTS.PROJID = PROJECTS.PROJID  		inner join USERCONTRACTS on USERCONTRACTS.THEID = CONTRACTS.CONTRID and USERCONTRACTS.LEV = 3  		WHERE USERCONTRACTS.INC = 1  	) INCLUDEDCONTRACTS  	on CONTRACTS.CONTRID = INCLUDEDCONTRACTS.CONTRID  	and USERCONTRACTS.USERID = INCLUDEDCONTRACTS.USERID  	WHERE USERCONTRACTS.INC = 0  	and INCLUDEDCONTRACTS.CONTRID is null  	UNION ALL  	select CONTRACTS.CONTRID, USERCONTRACTS.USERID  	from BORGS  	inner join PROJECTS on PROJECTS.BORGID = BORGS.BORGID  	inner join CONTRACTS on CONTRACTS.PROJID = PROJECTS.PROJID  	inner join USERCONTRACTS on USERCONTRACTS.THEID = CONTRACTS.CONTRID and USERCONTRACTS.LEV = 3  	WHERE USERCONTRACTS.INC = 0  ) as TABLEEXCLUDE  on TABLEINCLUDE.CONTRID = TABLEEXCLUDE.CONTRID  AND TABLEINCLUDE.USERID = TABLEEXCLUDE.USERID  WHERE TABLEEXCLUDE.CONTRID IS NULL  AND TABLEEXCLUDE.USERID IS NULL 