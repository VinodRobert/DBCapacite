/****** Object:  Procedure [BS].[REQ_BOOKKEEPING]    Committed by VersionSQL https://www.versionsql.com ******/

CREATE PROCEDURE [BS].[REQ_BOOKKEEPING] 
AS
-- Making the Status as Cancelled
SELECT REQ.REQID,ISNULL(COUNT(REQITEMS.LINENUMBER),0) ITEMCOUNT INTO #TEMP1 FROM REQ LEFT OUTER JOIN REQITEMS ON REQ.REQID=REQITEMS.REQID GROUP BY REQ.REQID  
UPDATE REQ SET REQSTATUSID=36 WHERE REQID IN (SELECT REQID FROM #TEMP1 WHERE ITEMCOUNT=0)