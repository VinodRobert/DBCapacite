/****** Object:  Procedure [BI].[CREDITORTRANSDUMP]    Committed by VersionSQL https://www.versionsql.com ******/

CREATE   PROCEDURE BI.CREDITORTRANSDUMP
AS

SELECT 
 T.ORGID,
 B.BORGNAME,
 T.YEAR,
 T.PERIOD,
 T.CREDNO,
 S.CREDNAME,
 T.PDATE,
 T.RECEIVEDDATE,
 T.BATCHREF,
 T.TRANSREF,
 T.TRANSTYPE,
 T.LEDGERCODE,
 T.DESCRIPTION,
 T.DEBIT,
 T.CREDIT,
 T.HOMECURRAMOUNT
INTO #TEMP0 
FROM 
 TRANSACTIONS T
 INNER JOIN BORGS B ON T.ORGID=B.BORGID 
 INNER JOIN CREDITORS S ON T.CREDNO=S.CREDNUMBER 
WHERE
 T.ORGID IN (SELECT BORGID FROM VRCILPROJETS) AND 
 T.LEDGERCODE='1315000'  AND 
 T.YEAR=2017 AND T.PERIOD BETWEEN 0 AND 3 


 

UPDATE #TEMP0 SET DEBIT =HOMECURRAMOUNT WHERE HomeCurrAmount>0 AND DEBIT>0 
UPDATE #TEMP0 SET CREDIT=HOMECURRAMOUNT WHERE HOMECURRAMOUNT>0 AND CREDIT>0 

SELECT * INTO VR9999 FROM #TEMP0 ORDER BY ORGID,CREDNO,PERIOD
SELECT SUM(CREDIT-DEBIT) FROM VR9999

 