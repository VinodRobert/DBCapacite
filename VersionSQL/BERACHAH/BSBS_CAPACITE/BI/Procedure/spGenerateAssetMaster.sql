/****** Object:  Procedure [BI].[spGenerateAssetMaster]    Committed by VersionSQL https://www.versionsql.com ******/

  
CREATE PROCEDURE [BI].[spGenerateAssetMaster](@CHOICE INT)
AS



SELECT 
 ASSETNUMBER,
 ASSETNAME,
 ASSETPDATE,
 ASSETPPRICE,
 ASSETPPRICE ASSETVALUE,
 ASSETSALVAGE,
 AssetAccumDep,
 AssetBookValue,
 ASSETPERIOD TOTALLIFE,
 ASSETDEP    REMAININGLIFE,
 ASSETLOCATION,
 ASSETOPPCODE,
 ASSETCATEGORY CATEGORY,
 SPACE(100) LOCATION ,
 ASSETID
INTO #TEMP0
FROM ASSETS 
WHERE ASSETSTATUS=@CHOICE 
ORDER BY ASSETPDATE  DESC

UPDATE #TEMP0 SET LOCATION = UPPER(BORGNAME) FROM BORGS INNER JOIN #TEMP0 ON LEFT(BORGS.BORGNAME,5)=#TEMP0.AssetLocation


SELECT DISTINCT COLKEY AS ASSETID  
INTO #TEMPATTRIBUTE
FROM ATTRIBVALUE WHERE TABLENAME='ASSETS'

ALTER TABLE #TEMPATTRIBUTE ADD DUTYBENEFITS DECIMAL(18,2)
ALTER TABLE #TEMPATTRIBUTE ADD FEREVALUATION DECIMAL(18,2)
ALTER TABLE #TEMPATTRIBUTE ADD INVOICENO     VARCHAR(15)
ALTER TABLE #TEMPATTRIBUTE ADD GRN VARCHAR(25) 
ALTER TABLE #TEMPATTRIBUTE ADD ORDID INT 
ALTER TABLE #TEMPATTRIBUTE ADD INVOICEAMOUNT DECIMAL(18,2)
ALTER TABLE #TEMPATTRIBUTE ADD INVOICEDATE DATETIME
ALTER TABLE #TEMPATTRIBUTE ADD ORDERTYPE INT
ALTER TABLE #TEMPATTRIBUTE ADD TAXAMOUNT DECIMAL(18,2)
ALTER TABLE #TEMPATTRIBUTE ADD SUPPLIERNAME VARCHAR(200)
ALTER TABLE #TEMPATTRIBUTE ADD SUPPLIERCODE VARCHAR(15)
ALTER TABLE #TEMPATTRIBUTE ADD PONUMBER VARCHAR(50)
ALTER TABLE #TEMPATTRIBUTE ADD PODATE DATETIME
 

UPDATE #TEMPATTRIBUTE SET DUTYBENEFITS=VALUE FROM ATTRIBVALUE INNER JOIN #TEMPATTRIBUTE ON #TEMPATTRIBUTE.ASSETID = ATTRIBVALUE.COLKEY 
WHERE ATTRIBVALUE.ATTRIBUTE='DUTYBENEFITS'
UPDATE #TEMPATTRIBUTE SET FEREVALUATION=VALUE FROM ATTRIBVALUE INNER JOIN #TEMPATTRIBUTE ON #TEMPATTRIBUTE.ASSETID = ATTRIBVALUE.COLKEY 
WHERE ATTRIBVALUE.ATTRIBUTE='FEREVALUATION'
UPDATE #TEMPATTRIBUTE SET INVOICENO=VALUE FROM ATTRIBVALUE INNER JOIN #TEMPATTRIBUTE ON #TEMPATTRIBUTE.ASSETID = ATTRIBVALUE.COLKEY
WHERE ATTRIBVALUE.ATTRIBUTE='INVOICENO'
UPDATE #TEMPATTRIBUTE SET GRN=VALUE FROM ATTRIBVALUE INNER JOIN #TEMPATTRIBUTE ON #TEMPATTRIBUTE.ASSETID = ATTRIBVALUE.COLKEY
WHERE ATTRIBVALUE.ATTRIBUTE='GRN'
UPDATE #TEMPATTRIBUTE SET ORDID=VALUE FROM ATTRIBVALUE INNER JOIN #TEMPATTRIBUTE ON #TEMPATTRIBUTE.ASSETID = ATTRIBVALUE.COLKEY
WHERE ATTRIBVALUE.ATTRIBUTE='ORDID'

UPDATE #TEMPATTRIBUTE SET PODATE=VALUE FROM ATTRIBVALUE INNER JOIN #TEMPATTRIBUTE ON #TEMPATTRIBUTE.ASSETID = ATTRIBVALUE.COLKEY 
WHERE ATTRIBVALUE.ATTRIBUTE='PODATE'
UPDATE #TEMPATTRIBUTE SET PONUMBER=VALUE FROM ATTRIBVALUE INNER JOIN #TEMPATTRIBUTE ON #TEMPATTRIBUTE.ASSETID = ATTRIBVALUE.COLKEY 
WHERE ATTRIBVALUE.ATTRIBUTE='PONUMBER'
UPDATE #TEMPATTRIBUTE SET SUPPLIERCODE=VALUE FROM ATTRIBVALUE INNER JOIN #TEMPATTRIBUTE ON #TEMPATTRIBUTE.ASSETID = ATTRIBVALUE.COLKEY
WHERE ATTRIBVALUE.ATTRIBUTE='SUPPLIERCODE'
UPDATE #TEMPATTRIBUTE SET SUPPLIERNAME=VALUE FROM ATTRIBVALUE INNER JOIN #TEMPATTRIBUTE ON #TEMPATTRIBUTE.ASSETID = ATTRIBVALUE.COLKEY
WHERE ATTRIBVALUE.ATTRIBUTE='SUPPLIERNAME'
UPDATE #TEMPATTRIBUTE SET TAXAMOUNT=VALUE FROM ATTRIBVALUE INNER JOIN #TEMPATTRIBUTE ON #TEMPATTRIBUTE.ASSETID = ATTRIBVALUE.COLKEY
WHERE ATTRIBVALUE.ATTRIBUTE='TAXAMOUNT'


UPDATE #TEMPATTRIBUTE SET INVOICEAMOUNT=VALUE FROM ATTRIBVALUE INNER JOIN #TEMPATTRIBUTE ON #TEMPATTRIBUTE.ASSETID = ATTRIBVALUE.COLKEY
WHERE ATTRIBVALUE.ATTRIBUTE='INVOICEAMOUNT'
UPDATE #TEMPATTRIBUTE SET INVOICEDATE=VALUE FROM ATTRIBVALUE INNER JOIN #TEMPATTRIBUTE ON #TEMPATTRIBUTE.ASSETID = ATTRIBVALUE.COLKEY
WHERE ATTRIBVALUE.ATTRIBUTE='INVOICEDATE'
UPDATE #TEMPATTRIBUTE SET ORDERTYPE=VALUE FROM ATTRIBVALUE INNER JOIN #TEMPATTRIBUTE ON #TEMPATTRIBUTE.ASSETID = ATTRIBVALUE.COLKEY
WHERE ATTRIBVALUE.ATTRIBUTE='ORDERTYPE'


SELECT 
 CATEGORY,
 T.ASSETLOCATION PROJECTCODE,
 T.LOCATION,
 T.ASSETNUMBER,
 T.ASSETNAME,
 T.ASSETPDATE PURCHASEDATE,
 T.ASSETVALUE PURCHASEVALUE,
 T.ASSETSALVAGE SALVAGEVALUE,
 T.ASSETACCUMDEP ACCUMDEP,
 T.ASSETBOOKVALUE BOOKVALUE,
 T.TOTALLIFE LIFE,
 T.REMAININGLIFE,
 A.PONUMBER,
 A.PODATE,
 A.SUPPLIERCODE,
 A.SUPPLIERNAME,
 A.INVOICENO,
 A.INVOICEDATE,
 A.INVOICEAMOUNT,
 A.DUTYBENEFITS,
 A.FEREVALUATION ,
 T.ASSETID 
FROM 
 #TEMP0  T
 LEFT OUTER JOIN #TEMPATTRIBUTE A ON A.ASSETID = T.ASSETID 
ORDER BY
 ASSETID DESC


 

 